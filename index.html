<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>恒安嘉新网络攻防实训平台</title>
  <link rel="stylesheet" href="./ctf/playground.css">
</head>
<body>
  <div style="position: absolute;right: 10px;top: 10px;z-index: 1000;">
    <button id="scene-1">主监控</button>
    <button id="scene-2">队伍详情</button>
    <button id="scene-3">排位详情</button>
  </div>
  <div class="scene playground show"></div>
  <div class="scene teaminfo hide"></div>
  <div class="load-ui"></div>

  <script src="/node_modules/axios/dist/axios.min.js"></script>
  <script type="module">
    import { Playground, Target, Team } from './ctf/playground.js'
    import { TeamInfo } from './ctf/teaminfo.js'

    // 取随机数
    function random(min, max) {
      return Math.floor(Math.random() * (max - min + 1) + min)
    }

    const playgrouneEl = document.querySelector('.playground')
    const playground = new Playground(playgrouneEl)
    playground.stateShow = true

    const teaminfoEl = document.querySelector('.teaminfo')
    const teaminfo = new TeamInfo(teaminfoEl)
    
    playground.ready(() => {

      let targets = []
      let teams = []

      function randomAttack() {
        if (!teams.length || !targets.length) return
        const team = teams[random(0, teams.length - 1)]
        const target = targets[random(0, targets.length - 1)]
        const isSuccess = Math.random() > 0.5
        team.toAttack(target, isSuccess)
        // console.log('attack:' + team.name + ' => ' + target.name, + '    ' + isSuccess)
        setTimeout(randomAttack, Math.random() * 10000)
      }
  
      axios.get('/json/targets.json').then(res => {
        const targetsData = res.data.sort((a, b) => b.score - a.score)
        targets = targetsData.map(t => new Target(t.name, t.score))
        playground.setTargets(targets)
      })

      axios.get('/json/teams.json').then(res => {
        const teamsData = res.data
        teams = teamsData.map(t => new Team(t.name))
        playground.setTeams(teams)

        // 5 秒后随机攻击
        setTimeout(randomAttack, 5000)
      })
    })


    

  
    document.querySelector('#scene-1').addEventListener('click', e => {
      playground.show()
      teaminfo.hide()
    })  
    document.querySelector('#scene-2').addEventListener('click', e => {
      playground.hide()
      teaminfo.show()
    }) 
    document.querySelector('#scene-3').addEventListener('click', e => {
      playground.hide()
      teaminfo.hide()
    })
  </script>
</body>
</html>