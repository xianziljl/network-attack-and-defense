<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>恒安嘉新网络攻防实训平台</title>
  <link rel="stylesheet" href="./dist/dist.css">
</head>
<body>
  <div class="playground"></div>
  <div style="position: absolute;bottom: 0;left: 0;z-index: 1000;font-size: 12px;padding: 5px;">
    <!-- <div>team: <span id="t"></span></div>
    <div>target: <span id="ta"></span></div>
    <div>bullet: <span id="b"></span></div>
    <div>fire: <span id="f"></span></div> -->
  </div>

  <script type="module">
    import { Playground, Target, Team } from '/dist/dist.js'

    // 取随机数
    function getRandom(min, max) {
      return Math.floor(Math.random() * (max - min + 1) + min)
    }

    const playgrouneEl = document.querySelector('.playground')
    const playground = new Playground(playgrouneEl)
    
    playground.ready = () => {
      // 是否显示帧率
      // playground.stateShow = true

      const targetCount = 20 // 队伍数量
      const teamCount = 20 // 关卡数量

      // 初始化了目标
      const targets = Array(targetCount).fill().map((_, i) => new Target('目标-' + i, i * 2 + 100))
      playground.setTargets(targets)

      // 初始化队伍
      const teams = Array(teamCount).fill().map((_, i) => new Team('战队-' + i))
      playground.setTeams(teams)

      setTimeout(randomAttack, 5000) // 随机攻击

      function randomAttack() {
        const team = teams[getRandom(0, teamCount - 1)]
        const target = targets[getRandom(0, targetCount - 1)]
        const isSuccess = Math.random() > 0.5
        team.toAttack(target, isSuccess)
        
        setTimeout(randomAttack, Math.random() * 10000)
      }

      // document.addEventListener('dblclick', randomAttack)
      // teams.forEach(t => {
      //   t.panel.content.addEventListener('click', () => {
      //     // console.log(t)
      //     playground.focus(t)
      //     t.toAttack(targets[getRandom(0, targetCount - 1)], Math.random() > 0.5)
      //   })
      // })
    }
  
  </script>
</body>
</html>